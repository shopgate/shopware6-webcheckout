"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[39707],{707:(e,t,s)=>{s.r(t),s.d(t,{default:()=>A});class n{constructor(e){this.active=!0,this.pluginName="Shopgate Webcheckout Plugin",this.isDev=!1,this.isDev=e}supports(e,t,s){return console.warn(`[${this.pluginName}] Method 'supports' was not overridden by "`+this.constructor.name+'". Default return set to false.'),!1}execute(){console.warn(`[${this.pluginName}] Method 'execute' was not overridden by "`+this.constructor.name+'".')}disable(){this.active=!1}log(e){this.isDev&&console.warn(this.pluginName+": "+e)}}class i extends n{supports(e,t,s){return"sgwebcheckout"===e&&"login"===t||"checkout"===e&&"cartpage"===t}execute(e){window.SGAppConnector.sendAppCommand({c:"broadcastEvent",p:{event:"closeInAppBrowser",parameters:[{redirectTo:"/"}]}})}}class r extends n{supports(e,t,s){return"sgwebcheckout"===e&&"registered"===t||!s.guest&&"checkout"===e&&"confirmpage"===t&&s.referer.includes("checkout/register")}execute(e){e||this.log("Login success, but no context token is passed from twig template"),window.SGAppConnector.sendPipelineRequest("shopgate.user.loginUser.v1",!0,{strategy:"auth_code",parameters:{code:e.token}},function(){window.SGAppConnector.sendAppCommands([{c:"broadcastEvent",p:{event:"userLoggedIn"}}])},[])}}class o extends n{supports(e,t,s){return"checkout"===e&&"finishpage"===t}execute(e){e||this.log("Checkout success, but order parameters are empty"),window.SGAppConnector.sendAppCommands([{c:"broadcastEvent",p:{event:"checkoutSuccess",parameters:[e]}},{c:"setNavigationBarParams",p:{navigationBarParams:{leftButton:!1,rightButton:!0,rightButtonType:"close",rightButtonCallback:"SGAction.broadcastEvent({event: 'closeInAppBrowser','parameters': [{'redirectTo': '/'}]});"}}}])}}let a="loader",c={BEFORE:"before",INNER:"inner"};class l{constructor(e,t=c.BEFORE){this.parent=e instanceof Element?e:document.body.querySelector(e),this.position=t}create(){if(!this.exists()){if(this.position===c.INNER){this.parent.innerHTML=l.getTemplate();return}this.parent.insertAdjacentHTML(this._getPosition(),l.getTemplate())}}remove(){this.parent.querySelectorAll(`.${a}`).forEach(e=>e.remove())}exists(){return this.parent.querySelectorAll(`.${a}`).length>0}_getPosition(){return this.position===c.BEFORE?"afterbegin":"beforeend"}static getTemplate(){return`<div class="${a}" role="status">
                    <span class="visually-hidden">Loading...</span>
                </div>`}static SELECTOR_CLASS(){return a}}class d{static isTouchDevice(){return"ontouchstart"in document.documentElement}static isIOSDevice(){return d.isIPhoneDevice()||d.isIPadDevice()}static isNativeWindowsBrowser(){return d.isIEBrowser()||d.isEdgeBrowser()}static isIPhoneDevice(){return!!navigator.userAgent.match(/iPhone/i)}static isIPadDevice(){return!!navigator.userAgent.match(/iPad/i)}static isIEBrowser(){return -1!==navigator.userAgent.toLowerCase().indexOf("msie")||!!navigator.userAgent.match(/Trident.*rv:\d+\./)}static isEdgeBrowser(){return!!navigator.userAgent.match(/Edge\/\d+/i)}static getList(){return{"is-touch":d.isTouchDevice(),"is-ios":d.isIOSDevice(),"is-native-windows":d.isNativeWindowsBrowser(),"is-iphone":d.isIPhoneDevice(),"is-ipad":d.isIPadDevice(),"is-ie":d.isIEBrowser(),"is-edge":d.isEdgeBrowser()}}}let p="modal-backdrop",u="modal-backdrop-open",h="no-scroll",m={ON_CLICK:"backdrop/onclick"};class v{constructor(){return v.instance||(v.instance=this),v.instance}create(e){this._removeExistingBackdrops(),document.body.insertAdjacentHTML("beforeend",this._getTemplate());let t=document.body.lastChild;document.documentElement.classList.add(h),setTimeout(function(){t.classList.add(u),"function"==typeof e&&e()},75),this._dispatchEvents()}remove(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:350;this._getBackdrops().forEach(e=>e.classList.remove(u)),setTimeout(this._removeExistingBackdrops.bind(this),e),document.documentElement.classList.remove(h)}_dispatchEvents(){let e=d.isTouchDevice()?"touchstart":"click";document.addEventListener(e,function(e){e.target.classList.contains(p)&&document.dispatchEvent(new CustomEvent(m.ON_CLICK))})}_getBackdrops(){return document.querySelectorAll(`.${p}`)}_removeExistingBackdrops(){!1!==this._exists()&&this._getBackdrops().forEach(e=>e.remove())}_exists(){return document.querySelectorAll(`.${p}`).length>0}_getTemplate(){return`<div class="${p}"></div>`}}let g=Object.freeze(new v);class w{static create(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;g.create(e)}static remove(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:350;g.remove(e)}static SELECTOR_CLASS(){return p}}let E=Object.freeze(new class extends l{constructor(){super(document.body)}create(){let e=!(arguments.length>0)||void 0===arguments[0]||arguments[0];!this.exists()&&e&&(w.create(),document.querySelector(`.${w.SELECTOR_CLASS()}`).insertAdjacentHTML("beforeend",l.getTemplate()))}remove(){let e=!(arguments.length>0)||void 0===arguments[0]||arguments[0];super.remove(),e&&w.remove()}});class f{static create(){let e=!(arguments.length>0)||void 0===arguments[0]||arguments[0];E.create(e)}static remove(){let e=!(arguments.length>0)||void 0===arguments[0]||arguments[0];E.remove(e)}}class S extends n{supports(e,t,s){return"product"===e&&"index"===t}execute(e){let t=window.PluginManager.getPluginInstanceFromElement(document.querySelector("[data-add-to-cart]"),"AddToCart");t.$emitter.subscribe("beforeFormSubmit",()=>f.create()),t.$emitter.subscribe("openOffCanvasCart",this.closeBrowser.bind(this))}closeBrowser(){window.SGAppConnector.sendAppCommand({c:"broadcastEvent",p:{event:"closeInAppBrowser",parameters:[{redirectTo:"/cart"}]}}),f.remove()}}class b{constructor(e,t,s,n){this.controllerName=e,this.actionName=t,this.properties=s,this.isDev="dev"===n,this.events=[]}registerDefaultEvents(){this.registerEvent(i),this.registerEvent(r),this.registerEvent(o),this.registerEvent(S)}registerEvent(e){this.events.push(new e(this.isDev))}executeEvents(){this.events.forEach(e=>{e.supports(this.controllerName,this.actionName,this.properties)&&e.active&&(e.log("Executing event > "+e.constructor.name),e.execute(this.properties))})}disableEvents(){this.events.forEach(e=>{e.disable()})}}class A extends window.PluginBaseClass{init(){let{controllerName:e,actionName:t,properties:s,env:n,isSgWebView:i}=this.options;this.eventManager=new b(e,t,s,n),this.devMode=i,this.enableShopgateAppEvents(),this.initSGBridge(this.devMode),this.executeWithRetry(40,3e3,this.initShopgateApp.bind(this))}enableShopgateAppEvents(){let e="libshopgate";if(document.getElementById(e))return;let t=document.createElement("meta");t.setAttribute("id",e),t.src=e,document.getElementsByTagName("head").item(0).appendChild(t)}executeWithRetry(e,t,s){let n=Date.now();if(s())return;let i=setInterval(function(){if(n+t<=Date.now()){clearInterval(i);return}s()&&clearInterval(i)},e)}initShopgateApp(){return(!!window.SGJavascriptBridge||!!this.devMode)&&(this.eventManager.registerDefaultEvents(),this.eventManager.executeEvents(),setTimeout(function(){window.SGAppConnector.closeLoadingSpinner()},3e3),!0)}initSGBridge(e){window.SGAppConnector={pipelineResponseHandler:{},functionExists:function(e){return"function"==typeof e},sendAppCommands:function(e){this.mockDev(e);let t="12.0";"dispatchCommandsForVersion"in window.SGJavascriptBridge?window.SGJavascriptBridge.dispatchCommandsForVersion(e,t):window.SGJavascriptBridge.dispatchCommandsStringForVersion(JSON.stringify(e),t)},sendAppCommand:function(e){this.sendAppCommands([e])},closeLoadingSpinner:function(){this.sendAppCommand({c:"onload"})},sendPipelineRequest:function(e,t,s,n,i){s||(s={}),i||(i=null);let r={c:"sendPipelineRequest",p:{serial:e,name:e,input:s}};t&&(r.p.type="trusted"),this.pipelineResponseHandler[e]={callbackParams:i,__call:function(t,s,i){if(!window.SGAppConnector.functionExists(n)){console.log("## no callback registered for pipeline call: "+e);return}return console.log("## running response callback for pipeline call: "+e),n(t,s,i)}},this.sendAppCommand(r)},mockDev:function(t){let s=e=>console.log(JSON.stringify(e));e&&(window.SGJavascriptBridge?s(t):window.SGJavascriptBridge={dispatchCommandsForVersion:s})}},window.SGEvent={__call:function(e,t){console.log("# Received event "+e),t&&Array.isArray(t)||(t=[]),SGEvent[e]&&SGEvent[e].apply(SGEvent,t)},pipelineResponse:function(e,t,s){if(e&&console.error("Called pipeline '"+t+"' resulted in an error: "+JSON.stringify(e)),window.SGAppConnector.pipelineResponseHandler[t]){let n=window.SGAppConnector.pipelineResponseHandler[t];return n.__call(e,s,n.callbackParams)}},isDocumentReady:function(){return!0}}}constructor(...e){super(...e),this.options={controllerName:null,actionName:null,properties:null,env:null,isSgWebView:!1,referer:""}}}}}]);